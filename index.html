<html>

<head>
  <meta charset="UTF-8">
  <title>Ma bang</title>
  <link rel="stylesheet" type="text/css" href="styles.css"/>
</head>

<body>
    <div>
        <label>ma bang</label>
        <textarea id="encryptText" width="500px"></textarea>
        <input type="text" id="baseCol">
        <button id="decrypt"> Run</button>
        <div class="results">
          <div class="resultCol">
            <label style="display: block;">Cột phải</label>
            <div id="resultsRight"></div>
          </div>
          <div class="resultCol">
            <label style="display: block;">Cột trái</label>
            <div id="resultsLeft"></div>
          </div>

        </div>



    </div>
  <script crossorigin="anonymous" referrerpolicy="no-referrer">
    var encryptText = document.getElementById("encryptText");
    var decrypt = document.getElementById("decrypt");
    var baseColumn = document.getElementById("baseCol");
    var resultsLeft = document.getElementById("resultsLeft");
    var resultsRight = document.getElementById("resultsRight");

    var frequence = {'AA':0.001, 'AB':0.011, 'AC':0.104, 'AD':0.04, 'AG':0.005, 'AH':0.024, 'AI':0.066, 'AK':0.008, 'AL':0.01, 'AM':0.07, 'AN':0.371, 'AO':0.048, 'AP':0.047, 'AQ':0.006, 'AR':0.003, 'AS':0.006, 'AT':0.092, 'AU':0.032, 'AV':0.011, 'AX':0.007, 'AY':0.037, 'BA':0.464, 'BC':0.01, 'BE':0.026, 'BI':0.228, 'BL':0.001, 'BO':0.194, 'BS':0.001, 'BT':0.001, 'BU':0.073, 'CA':0.123, 'CB':0.011, 'CC':0.037, 'CD':0.054, 'CG':0.009, 'CH':0.321, 'CK':0.015, 'CL':0.031, 'CM':0.016, 'CN':0.022, 'CO':0.096, 'CP':0.013, 'CQ':0.005, 'CR':0.001, 'CS':0.007, 'CT':0.061, 'CU':0.139, 'CV':0.027, 'CX':0.008, 'CY':0.001, 'DA':0.45, 'DD':0.003, 'DE':0.078, 'DI':0.105, 'DO':0.21, 'DP':0.001, 'DT':0.003, 'DU':0.15, 'EA':0.001, 'EB':0.006, 'EC':0.045, 'ED':0.029, 'EG':0.014, 'EH':0.014, 'EK':0.011, 'EL':0.011, 'EM':0.056, 'EN':0.416, 'EO':0.018, 'EP':0.052, 'EQ':0.02, 'ER':0.007, 'ES':0.005, 'ET':0.165, 'EU':0.1, 'EV':0.018, 'EX':0.011, 'FA':0.2, 'FB':0.2, 'FE':0.4, 'FR':0.2, 'GA':0.035, 'GB':0.025, 'GC':0.121, 'GD':0.105, 'GG':0.012, 'GH':0.106, 'GI':0.084, 'GK':0.03, 'GL':0.054, 'GM':0.024, 'GN':0.075, 'GO':0.026, 'GP':0.019, 'GQ':0.019, 'GR':0.006, 'GS':0.029, 'GT':0.121, 'GU':0.042, 'GV':0.057, 'GX':0.009, 'GY':0.002, 'HA':0.215, 'HB':0.004, 'HC':0.027, 'HD':0.03, 'HE':0.039, 'HG':0.005, 'HH':0.011, 'HI':0.163, 'HK':0.005, 'HL':0.011, 'HM':0.028, 'HN':0.012, 'HO':0.182, 'HP':0.009, 'HQ':0.008, 'HR':0.003, 'HS':0.011, 'HT':0.052, 'HU':0.172, 'HV':0.01, 'HX':0.002, 'HY':0.001, 'IA':0.091, 'IB':0.015, 'IC':0.098, 'ID':0.054, 'IE':0.278, 'IG':0.01, 'IH':0.027, 'II':0.007, 'IK':0.013, 'IL':0.022, 'IM':0.024, 'IN':0.177, 'IO':0.012, 'IP':0.023, 'IQ':0.018, 'IR':0.005, 'IS':0.012, 'IT':0.066, 'IU':0.011, 'IV':0.031, 'IX':0.007, 'IY':0.001, 'JE':1.0, 'KA':0.002, 'KE':0.143, 'KH':0.518, 'KI':0.25, 'KM':0.001, 'KY':0.084, 'LA':0.446, 'LD':0.001, 'LE':0.068, 'LI':0.096, 'LO':0.152, 'LU':0.213, 'LY':0.023, 'MA':0.229, 'MB':0.016, 'MC':0.064, 'MD':0.064, 'ME':0.013, 'MG':0.012, 'MH':0.013, 'MI':0.085, 'MK':0.014, 'ML':0.033, 'MM':0.015, 'MN':0.03, 'MO':0.173, 'MP':0.015, 'MQ':0.008, 'MR':0.005, 'MS':0.012, 'MT':0.07, 'MU':0.041, 'MV':0.057, 'MX':0.005, 'MY':0.029, 'NA':0.041, 'NB':0.014, 'NC':0.05, 'ND':0.056, 'NE':0.008, 'NG':0.395, 'NH':0.211, 'NI':0.004, 'NK':0.012, 'NL':0.02, 'NM':0.009, 'NN':0.023, 'NO':0.016, 'NP':0.01, 'NQ':0.006, 'NR':0.003, 'NS':0.008, 'NT':0.065, 'NU':0.022, 'NV':0.02, 'NX':0.006, 'NY':0.001, 'OA':0.067, 'OB':0.008, 'OC':0.205, 'OD':0.038, 'OE':0.001, 'OG':0.005, 'OH':0.01, 'OI':0.175, 'OK':0.008, 'OL':0.015, 'OM':0.015, 'ON':0.319, 'OO':0.001, 'OP':0.022, 'OQ':0.008, 'OR':0.007, 'OS':0.013, 'OT':0.058, 'OU':0.001, 'OV':0.019, 'OX':0.002, 'OY':0.002, 'PA':0.005, 'PB':0.017, 'PC':0.057, 'PD':0.067, 'PG':0.007, 'PH':0.569, 'PI':0.001, 'PK':0.011, 'PL':0.017, 'PM':0.012, 'PN':0.039, 'PO':0.008, 'PP':0.014, 'PQ':0.008, 'PR':0.005, 'PS':0.006, 'PT':0.096, 'PU':0.01, 'PV':0.041, 'PX':0.009, 'PY':0.001, 'QT':0.002, 'QU':0.998, 'RA':0.309, 'RC':0.003, 'RD':0.003, 'RE':0.058, 'RH':0.001, 'RI':0.193, 'RM':0.001, 'RN':0.001, 'RO':0.24, 'RT':0.003, 'RU':0.185, 'RV':0.001, 'SA':0.406, 'SD':0.013, 'SE':0.02, 'SI':0.033, 'SO':0.188, 'SP':0.001, 'SS':0.001, 'ST':0.003, 'SU':0.334, 'SV':0.001, 'TA':0.09, 'TB':0.008, 'TC':0.029, 'TD':0.034, 'TE':0.027, 'TG':0.003, 'TH':0.233, 'TI':0.067, 'TK':0.006, 'TL':0.013, 'TM':0.006, 'TN':0.044, 'TO':0.077, 'TP':0.005, 'TQ':0.007, 'TR':0.218, 'TS':0.009, 'TT':0.043, 'TU':0.064, 'TV':0.011, 'TX':0.004, 'TY':0.002, 'UA':0.173, 'UB':0.01, 'UC':0.125, 'UD':0.033, 'UE':0.003, 'UG':0.005, 'UH':0.012, 'UI':0.003, 'UK':0.014, 'UL':0.013, 'UM':0.007, 'UN':0.158, 'UO':0.252, 'UP':0.008, 'UQ':0.007, 'UR':0.004, 'US':0.009, 'UT':0.068, 'UU':0.013, 'UV':0.016, 'UX':0.002, 'UY':0.066, 'VA':0.469, 'VC':0.002, 'VD':0.001, 'VE':0.096, 'VI':0.194, 'VN':0.001, 'VO':0.123, 'VT':0.001, 'VU':0.109, 'VV':0.004, 'WA':0.059, 'WC':0.059, 'WH':0.059, 'WN':0.059, 'WT':0.118, 'WV':0.529, 'WW':0.118, 'XA':0.602, 'XB':0.026, 'XC':0.011, 'XD':0.008, 'XE':0.023, 'XG':0.001, 'XH':0.001, 'XI':0.063, 'XK':0.001, 'XL':0.002, 'XM':0.001, 'XN':0.002, 'XO':0.057, 'XP':0.001, 'XT':0.005, 'XU':0.178, 'XV':0.003, 'XX':0.014, 'YA':0.001, 'YB':0.028, 'YC':0.084, 'YD':0.144, 'YE':0.332, 'YG':0.018, 'YH':0.02, 'YK':0.019, 'YL':0.045, 'YM':0.042, 'YN':0.069, 'YO':0.004, 'YP':0.009, 'YQ':0.016, 'YR':0.007, 'YS':0.03, 'YT':0.073, 'YU':0.001, 'YV':0.043, 'YX':0.012, 'YY':0.003, 'ZI':1.0}
    decrypt.onclick = async function(){
        let text = loc(encryptText.value);
        let baseCol = loc(baseColumn.value);
        
        console.log(text);
        console.log(baseCol);
        let bestColLeft = await getBestColsLeft(baseCol, text);
        let bestColRight = await getBestColsRight(baseCol, text);
        console.log(bestColRight);
        display_bestCols(bestColLeft, bestColRight);
    }
    function display_bestCols(bestColLeft, bestColRight){

      while (resultsLeft.lastElementChild)
        resultsLeft.removeChild(resultsLeft.lastElementChild);
      while(resultsRight.lastElementChild)
        resultsRight.removeChild(resultsRight.lastElementChild);


      for(let i=0;i<Math.min(10,bestColLeft.length);++i){
        let newCol = document.createElement('Label');
        newCol.innerHTML = bestColLeft[i][0];
        newCol.style.display="block";
        resultsLeft.appendChild(newCol);
      }

      for(let i=0;i<Math.min(10,bestColRight.length);++i){
        let newCol = document.createElement('Label');
        newCol.innerHTML = bestColRight[i][0];
        newCol.style.display="block";
        resultsRight.appendChild(newCol);
      }
    }
    function getScoreTwoCol(x,y){
      if (x.length != y.length){
        console.log("ERROR");
        return 0;
      }
      let score = 0;
      for(let i=0;i<x.length;++i)
        if (frequence.hasOwnProperty(x[i]+y[i]))
          score += frequence[x[i]+y[i]];
      console.log('score',score);
      return score;
    }

    function getBestColsLeft(x, text){
      let m = x.length;
      let sortable = [];
      for (let i=0;i<text.length-m;++i){
          let cntCol = text.substring(i,i+m);
          sortable.push([cntCol,getScoreTwoCol(x,cntCol)]);
      }
      sortable.sort(function(a,b){
        return b[1]-a[1];
      });
      return sortable;
    }

    function getBestColsRight(x, text){
      let m = x.length;
          let sortable = [];
          for (let i=0;i<text.length-m;++i){
              let cntCol = text.substring(i,i+m);
              sortable.push([cntCol,getScoreTwoCol(cntCol,x)]);
          }
          sortable.sort(function(a,b){
            return b[1]-a[1];
          });
          return sortable;
    }

    function loc(x){
      x = x.replace(/(\r\n|\n|\r|\s)/gm,"");
      return x;
    }
    
  </script>
</body>

</html>
